<ion-header>
    <ion-toolbar color="primary">
      <ion-buttons slot="start">
        <ion-back-button></ion-back-button>
      </ion-buttons>
      <ion-title>Nuevo reclamo</ion-title>
    </ion-toolbar>
</ion-header>
  
<ion-content>
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <ion-item class="image" (click)="changePicture()">
      <img [src]="picture" onError="this.src='assets/imgs/no-image.jpg'">
    </ion-item>

    <!-- Selects para reclamos -->
    <ion-item *ngIf="type === 'claim'">
      <ion-label position="floating">Tipo</ion-label>
      <ion-select formControlName="selectedClaimType" (ionChange)="onChangeClaimType()">
        <ion-select-option *ngFor="let category of categories" [value]="category" [disabled]="action === 'watch'">
          {{category?.CTdescription}}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item *ngIf="type === 'claim'">
      <ion-label position="floating">Subcategoría</ion-label>
      <ion-select [disabled]="!form.value.selectedClaimType" formControlName="category">
        <ion-select-option *ngFor="let subcategory of form.value.selectedClaimType?.claimSubcategory"
          [value]="subcategory?.claimSubcategoryId" [disabled]="action === 'watch'">
          {{subcategory?.CSCdescription}}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Select para hechos de inseguridad -->
    <ion-item *ngIf="type === 'insecurityFact'">
      <ion-label position="floating">Tipo</ion-label>
      <ion-select formControlName="category">
        <ion-select-option *ngFor="let category of categories" [value]="category?.insecurityFactTypeId"
          [disabled]="action === 'watch'">
          {{category?.IFTdescription}}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <div *ngIf="!isFieldValid('category')" class="invalid-input-message">
      {{getFieldError('category')}}
    </div>
      
    <ion-row>
      <ion-col>
        <ion-item class="class-input">
          <ion-label position="floating">Calle</ion-label>
          <ion-input type="text" readonly=true formControlName="street" [disabled]="action === 'watch'"> </ion-input>
        </ion-item>
        <ion-item class="class-input">
          <ion-label position="floating">Número</ion-label>
          <ion-input type="text" readonly=true formControlName="streetNumber" [disabled]="action === 'watch'"> </ion-input>
        </ion-item>
      </ion-col>
      <ion-col>
        <ion-button style="height: 30px;" type="button" color="tertiary" fill="outline" (click)="goToMap()" slot="end">
          Localizar
        </ion-button>
      </ion-col>
    </ion-row>

    <div *ngIf="!isFieldValid('streetNumber')" class="invalid-input-message">
      {{getFieldError('streetNumber')}}
    </div>

    <ion-item>
      <ion-label position="floating">Comentario</ion-label>
      <ion-input type="text" formControlName="comment" [disabled]="action === 'watch'"></ion-input>
    </ion-item>
    <div *ngIf="!isFieldValid('comment')" class="invalid-input-message">
      {{getFieldError('comment')}}
    </div>
    
    <ion-item>
      <ion-label position="floating">Fecha de ocurrencia</ion-label>
      <ion-datetime displayFormat="DD/MM/YYYY" done-text="Aceptar" cancel-text="Cancelar"
        formControlName="dateTimeObservation" [disabled]="action === 'watch'"></ion-datetime>
    </ion-item>
    <div *ngIf="!isFieldValid('dateTimeObservation')" class="invalid-input-message">
      {{getFieldError('dateTimeObservation')}}
    </div>

    <!-- Los dos campos de abajo serán mostrados en los reclamos creados previamente -->

    <ion-item *ngIf="!creating">
      <ion-label position="floating" disabled>Fecha de creación</ion-label>
      <ion-datetime displayFormat="DD/MM/YYYY" done-text="Aceptar" cancel-text="Cancelar" formControlName="dateTimeCreation"></ion-datetime>
    </ion-item>
    
    <ion-item *ngIf="!creating && role==='municipalAgent'">
      <ion-label position="floating">Estado</ion-label>
      <ion-select (ionChange)="changeStatus(status)">
        <ion-select-option *ngFor="let status of statuses" [value]="status?.statusId">{{status?.STAdescription}}</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item *ngIf="action === 'watch'">
      <ion-label position="floating">Asignar</ion-label>
      <ion-select formControlName="municipalAgentId" [disabled]="role !== 'municipalAgent'">
        <ion-select-option>Jorge Perez</ion-select-option>
      </ion-select>
    </ion-item>

    <div>
      <ion-button expand="block" color="primary" type="submit">
        <ion-text color="light">
          {{ creating ? 'Crear' : 'Editar' }}
        </ion-text>
      </ion-button>
    </div>
  </form>
</ion-content>